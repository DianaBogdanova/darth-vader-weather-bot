<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperial Weather Command</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Night sky with stars */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at top, #0a0a2e 0%, #000000 100%);
            z-index: -2;
        }
        
        #stars {
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent),
                radial-gradient(1px 1px at 33% 75%, white, transparent),
                radial-gradient(1px 1px at 66% 40%, white, transparent);
            background-size: 200% 200%;
            animation: twinkle 12s ease-in-out infinite, drift 40s linear infinite;
            z-index: -1;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        @keyframes drift {
            from { background-position: 0% 0%; }
            to { background-position: 100% 100%; }
        }
        
        /* Subtle nebula effect */
        #nebula {
            position: fixed;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(139, 0, 0, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(75, 0, 130, 0.1) 0%, transparent 50%);
            z-index: -1;
            opacity: 0.6;
        }
        
        .container {
            max-width: 900px;
            width: 90%;
            padding: 50px;
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid #ff0000;
            border-radius: 4px;
            box-shadow: 0 0 60px rgba(255, 0, 0, 0.4);
            backdrop-filter: blur(10px);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 1px solid #333;
            padding-bottom: 30px;
        }
        
        h1 {
            font-size: 3em;
            font-weight: 700;
            letter-spacing: 10px;
            color: #ff0000;
            text-transform: uppercase;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
        }
        
        .subtitle {
            font-size: 1em;
            color: #888;
            letter-spacing: 4px;
            text-transform: uppercase;
        }
        
        .location-display {
            text-align: center;
            font-size: 1.3em;
            color: #ff0000;
            margin-bottom: 35px;
            padding: 15px;
            background: rgba(139, 0, 0, 0.1);
            border: 1px solid #333;
            border-radius: 3px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .location-display span {
            color: #fff;
            font-weight: 600;
        }
        
        .input-section {
            margin-bottom: 35px;
        }
        
        label {
            display: block;
            color: #ff0000;
            font-size: 0.9em;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 18px;
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid #333;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1em;
            border-radius: 3px;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #ff0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.4);
            background: rgba(13, 13, 13, 0.9);
        }
        
        input[type="text"]::placeholder {
            color: #555;
        }
        
        button {
            width: 100%;
            padding: 18px;
            background: #ff0000;
            border: none;
            color: #000;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            letter-spacing: 4px;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        button:hover {
            background: #cc0000;
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.6);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .vader-response {
            background: rgba(139, 0, 0, 0.08);
            border-left: 4px solid #ff0000;
            padding: 30px;
            margin: 35px 0;
            font-size: 1.05em;
            line-height: 1.8;
            color: #ddd;
            min-height: 120px;
            display: none;
            border-radius: 3px;
        }
        
        .vader-response.show {
            display: block;
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .vader-label {
            color: #ff0000;
            font-weight: 700;
            letter-spacing: 1.5px;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .weather-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 18px;
            margin-top: 25px;
        }
        
        .data-item {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #333;
            padding: 20px;
            text-align: center;
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        .data-item:hover {
            border-color: #ff0000;
            background: rgba(139, 0, 0, 0.1);
        }
        
        .data-value {
            font-size: 2.2em;
            color: #ff0000;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }
        
        .data-label {
            font-size: 0.85em;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .loading {
            text-align: center;
            color: #ff0000;
            font-size: 1.1em;
            letter-spacing: 3px;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .examples {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #222;
            border-radius: 3px;
        }
        
        .examples-title {
            color: #ff0000;
            font-size: 0.9em;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .examples ul {
            list-style: none;
            color: #888;
            font-size: 0.95em;
            line-height: 2;
        }
        
        .examples li::before {
            content: "▸ ";
            color: #ff0000;
            font-weight: bold;
            margin-right: 8px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px solid #222;
            color: #555;
            font-size: 0.85em;
            letter-spacing: 2px;
        }
        
        .error-message {
            color: #ff0000;
            background: rgba(139, 0, 0, 0.1);
            padding: 15px;
            border: 1px solid #ff0000;
            border-radius: 3px;
            margin-top: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="stars"></div>
    <div id="nebula"></div>
    
    <div class="container">
        <header>
            <h1>IMPERIAL COMMAND</h1>
            <p class="subtitle">Atmospheric Intelligence System</p>
        </header>
        
        <div class="location-display" id="locationDisplay">
            Location: <span id="currentLocation">I Find Your Silence... Disturbing</span>
        </div>
        
        <div class="input-section">
            <label for="queryInput">⚫ State Your Location. The Empire's Satellites Stand Ready</label>
            <input 
                type="text" 
                id="queryInput" 
                placeholder="Tokyo weather now | London next 5 days | Paris yesterday"
                autocomplete="off"
            >
            <button id="submitBtn" onclick="processQuery()">Submit To The Empire</button>
        </div>
        
        <div class="vader-response" id="response">
            <div class="vader-label">⚫ DARTH VADER:</div>
            <div id="responseText"></div>
        </div>
        
        <div class="examples">
            <div class="examples-title">Learn From These, Young Apprentice</div>
            <ul>
                <li>"San Diego weather now"</li>
                <li>"Barcelona forecast for next 5 days"</li>
                <li>"Tokyo weather in 3 days"</li>
                <li>"What was London weather yesterday?"</li>
                <li>"New York next week"</li>
            </ul>
        </div>
        
        <footer>
            ⚫ THE EMPIRE'S WEATHER DOMINION IS ABSOLUTE ⚫
        </footer>
    </div>
    
    <script>
        const vaderIntros = [
            "The Empire's meteorological systems reveal",
            "I sense through the Force",
            "The Dark Side shows me",
            "Your inquiry is answered",
            "The atmospheric patterns are clear",
            "I have felt a great disturbance in the atmosphere",
            "The power of the Empire's satellites is absolute",
            "Search your feelings, you know the forecast to be true",
            "Do not underestimate the power of atmospheric data"
        ];
        
        async function geocodeLocation(cityName) {
            try {
                const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cityName)}&count=1&language=en&format=json`);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const result = data.results[0];
                    return {
                        lat: result.latitude,
                        lon: result.longitude,
                        name: result.name,
                        country: result.country
                    };
                }
                return null;
            } catch (error) {
                console.error('Geocoding error:', error);
                return null;
            }
        }
        
        function extractLocationFromQuery(query) {
            const patterns = [
                /\bin\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/,
                /\bfor\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/,
                /([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)'s\s+weather/,
                /weather\s+in\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/,
                /weather\s+for\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/,
                /^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+weather/,
                /^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+forecast/,
                /^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+next/,
                /^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+yesterday/,
                /^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+today/,
                /^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+now/
            ];
            
            for (let pattern of patterns) {
                const match = query.match(pattern);
                if (match) return match[1];
            }
            
            const words = query.split(/\s+/);
            if (words.length > 0 && words[0][0] === words[0][0].toUpperCase()) {
                const cityParts = [];
                for (let word of words) {
                    if (word[0] === word[0].toUpperCase() || ['de', 'la', 'del', 'von', 'san', 'santa'].includes(word.toLowerCase())) {
                        cityParts.push(word);
                    } else {
                        break;
                    }
                }
                const potentialCity = cityParts.join(' ');
                if (!['What', 'Show', 'Give', 'Tell', 'How', 'When', 'Where'].includes(potentialCity)) {
                    return potentialCity;
                }
            }
            
            return null;
        }
        
        function parseQuery(query) {
            const q = query.toLowerCase();
            const numbers = query.match(/\d+/);
            let days = numbers ? parseInt(numbers[0]) : null;
            
            if (q.includes('now') || q.includes('current') || q.includes('today')) {
                return { type: 'current' };
            } else if (q.includes('yesterday')) {
                return { type: 'history', days: 1 };
            } else if (q.includes('forecast') || q.includes('next') || q.includes('future') || q.includes('tomorrow')) {
                if (q.includes('tomorrow')) days = 2;
                return { type: 'forecast', days: days || 7 };
            } else if (q.includes('past') || q.includes('last') || q.includes('history') || q.includes('was')) {
                return { type: 'history', days: days || 7 };
            } else {
                return { type: 'current' };
            }
        }
        
        async function getCurrentWeather(lat, lon) {
            const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code,precipitation&temperature_unit=fahrenheit&wind_speed_unit=mph`);
            return await response.json();
        }
        
        async function getForecast(lat, lon, days) {
            const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weather_code&temperature_unit=fahrenheit&forecast_days=${Math.min(days, 16)}`);
            return await response.json();
        }
        
        async function getHistory(lat, lon, days) {
            const endDate = new Date();
            endDate.setDate(endDate.getDate() - 1);
            const startDate = new Date(endDate);
            startDate.setDate(startDate.getDate() - (days - 1));
            
            const format = (d) => d.toISOString().split('T')[0];
            const response = await fetch(`https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${format(startDate)}&end_date=${format(endDate)}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weather_code&temperature_unit=fahrenheit`);
            return await response.json();
        }
        
        function getWeatherAdvice(weatherCode, temp, precip) {
            let advice = [];
            
            if (weatherCode <= 1) {
                const spf = [
                    "The sun's rays are merciless. SPF protection is not weakness... it is wisdom.",
                    "Do not underestimate the power of UV radiation. Apply sunscreen, or suffer the consequences.",
                    "I find your lack of sunscreen... disturbing. The UV rays show no mercy.",
                    "SPF 50 or higher. This is not a request. It is a command from the Empire."
                ];
                advice.push(spf[Math.floor(Math.random() * spf.length)]);
            }
            
            if (weatherCode >= 51 || precip > 0.1) {
                const umbrella = [
                    "The skies will weep. Your umbrella is your only hope against the deluge.",
                    "Rain falls like the tears of the Rebel Alliance. I find your lack of umbrella... disturbing.",
                    "Precipitation is imminent. An umbrella would serve the Empire well in these conditions.",
                    "The clouds rebel against us. Bring an umbrella, or be soaked like a defeated enemy."
                ];
                advice.push(umbrella[Math.floor(Math.random() * umbrella.length)]);
            }
            
            return advice;
        }
        
        function generateVaderResponse(data, type, parsed, locationName) {
            const intro = vaderIntros[Math.floor(Math.random() * vaderIntros.length)];
            let response = `${intro}...<br><br>`;
            
            if (type === 'current') {
                const temp = data.current.temperature_2m;
                const humidity = data.current.relative_humidity_2m;
                const wind = data.current.wind_speed_10m;
                const weatherCode = data.current.weather_code;
                const precip = data.current.precipitation || 0;
                
                response += `<div class="weather-data">
                    <div class="data-item">
                        <div class="data-value">${temp}°F</div>
                        <div class="data-label">Temperature</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${humidity}%</div>
                        <div class="data-label">Humidity</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${wind}</div>
                        <div class="data-label">Wind MPH</div>
                    </div>
                </div><br>`;
                
                if (temp > 85) {
                    response += `The heat is oppressive at ${temp}°F. Like the flames that consumed me on Mustafar.`;
                } else if (temp > 75) {
                    response += `${temp}°F. A pleasant warmth. The Force is balanced today.`;
                } else if (temp > 60) {
                    response += `At ${temp}°F, the conditions are acceptable. Do not be deceived by comfort.`;
                } else {
                    response += `The cold grips at ${temp}°F. I find your lack of warm clothing... disturbing.`;
                }
                
                if (wind > 20) {
                    response += `<br><br>The winds rage at ${wind} mph. Strong, like the power of the Dark Side.`;
                }
                
                const advice = getWeatherAdvice(weatherCode, temp, precip);
                advice.forEach(a => response += `<br><br>${a}`);
                
            } else if (type === 'forecast') {
                const days = data.daily.time.length;
                response += `I have foreseen the next ${days} days:<br><br>`;
                
                response += '<div class="weather-data">';
                for (let i = 0; i < Math.min(days, 7); i++) {
                    response += `
                        <div class="data-item">
                            <div class="data-label">${data.daily.time[i]}</div>
                            <div class="data-value" style="font-size: 1.5em">${data.daily.temperature_2m_max[i]}°F</div>
                            <div class="data-label">High</div>
                            <div class="data-label">${data.daily.temperature_2m_min[i]}°F Low</div>
                        </div>
                    `;
                }
                response += '</div><br>';
                
                const avgHigh = data.daily.temperature_2m_max.reduce((a, b) => a + b) / data.daily.temperature_2m_max.length;
                response += `The average high will be ${avgHigh.toFixed(1)}°F. Plan accordingly.`;
                
            } else if (type === 'history') {
                const days = data.daily.time.length;
                response += `The archives reveal the past ${days} day(s):<br><br>`;
                
                response += '<div class="weather-data">';
                for (let i = 0; i < Math.min(days, 7); i++) {
                    response += `
                        <div class="data-item">
                            <div class="data-label">${data.daily.time[i]}</div>
                            <div class="data-value" style="font-size: 1.5em">${data.daily.temperature_2m_max[i]}°F</div>
                            <div class="data-label">High</div>
                            <div class="data-label">${data.daily.temperature_2m_min[i]}°F Low</div>
                        </div>
                    `;
                }
                response += '</div><br>';
                
                response += 'The past is unchangeable, like fate itself. What has been cannot be altered.';
            }
            
            return response;
        }
        
        async function processQuery() {
            const queryInput = document.getElementById('queryInput').value.trim();
            const responseDiv = document.getElementById('response');
            const responseText = document.getElementById('responseText');
            const submitBtn = document.getElementById('submitBtn');
            const locationDisplay = document.getElementById('currentLocation');
            
            if (!queryInput) {
                alert('You must specify a command. The Empire demands it.');
                return;
            }
            
            submitBtn.disabled = true;
            responseDiv.classList.remove('show');
            responseText.innerHTML = '<div class="loading">ACCESSING IMPERIAL SATELLITES</div>';
            responseDiv.classList.add('show');
            
            try {
                const locationName = extractLocationFromQuery(queryInput);
                
                if (!locationName) {
                    responseText.innerHTML = `You must specify a location. The Empire demands precision.<br><br>Example: "San Diego weather now" or "Tokyo forecast"`;
                    submitBtn.disabled = false;
                    return;
                }
                
                const location = await geocodeLocation(locationName);
                if (!location) {
                    responseText.innerHTML = `I find your location "${locationName}" disturbing. The Empire's systems cannot locate this place.`;
                    submitBtn.disabled = false;
                    return;
                }
                
                const fullLocationName = `${location.name}, ${location.country}`;
                locationDisplay.textContent = fullLocationName;
                
                const parsed = parseQuery(queryInput);
                let data, vaderResponse;
                
                if (parsed.type === 'current') {
                    data = await getCurrentWeather(location.lat, location.lon);
                    vaderResponse = generateVaderResponse(data, 'current', parsed, fullLocationName);
                } else if (parsed.type === 'forecast') {
                    data = await getForecast(location.lat, location.lon, parsed.days);
                    vaderResponse = generateVaderResponse(data, 'forecast', parsed, fullLocationName);
                } else if (parsed.type === 'history') {
                    data = await getHistory(location.lat, location.lon, parsed.days);
                    vaderResponse = generateVaderResponse(data, 'history', parsed, fullLocationName);
                }
                
                responseText.innerHTML = vaderResponse;
            } catch (error) {
                responseText.innerHTML = `The Empire's systems have experienced a disturbance. Most... disturbing.<br><br>Error: ${error.message}`;
            }
            
            submitBtn.disabled = false;
        }
        
        document.getElementById('queryInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') processQuery();
        });
    </script>
</body>
</html>
